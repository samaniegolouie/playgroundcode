<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Route Suggestions</title>
</head>
<body>
    <label for="origin">Origin:</label>
    <select id="origin">
       
    </select><br><br>
    <label for="destination">Destination:</label>
    <select id="destination">
       
    </select><br><br>
    <button onclick="calculateRoutes()">Calculate Routes</button><br><br>
    <div id="routeList"></div>
    <div id="ratesDisplay"></div> <!-- Add a div for displaying rates -->

    <script>
        async function calculateRoutes() {
            const origin = document.getElementById('origin').value;
            const destination = document.getElementById('destination').value;

            const originCoords = await getCoordinates(origin);
            const destinationCoords = await getCoordinates(destination);

            if (!originCoords || !destinationCoords) {
                alert('Error: Unable to find coordinates for origin or destination.');
                return;
            }

            const distance = calculateDistance(originCoords, destinationCoords);

            const routeList = document.getElementById('routeList');
            routeList.innerHTML = `
                <h3>Route</h3>
                <p>Distance: ${distance.toFixed(2)} km</p>
            `;

            displayRate(destination); // Call function to display rate for the selected destination
        }
 
        async function getCoordinates(location) {
            const url = `https://nominatim.openstreetmap.org/search.php?q=${location}&format=json`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                if (data.length > 0) {
                    return { lat: parseFloat(data[0].lat), lon: parseFloat(data[0].lon) };
                } else {
                    return null;
                }
            } catch (error) {
                console.error('Error fetching coordinates:', error);
                return null;
            }
        }

        async function populateOriginDropdown() {
            const originDropdown = document.getElementById('origin');
            const url = 'https://660d18973a0766e85dbf8c03.mockapi.io/locationtest';

            try {
                const response = await fetch(url);
                const data = await response.json();

                if (data.length > 0) {
                    data.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.value = option.location;
                        optionElement.textContent = option.location;
                        originDropdown.appendChild(optionElement);
                    });
                } else {
                    console.error('No data found for origin options.');
                }
            } catch (error) {
                console.error('Error fetching origin options:', error);
            }
        }

        async function populateDestinationDropdown() {
            const destinationDropdown = document.getElementById('destination');
            const url = 'https://660d18973a0766e85dbf8c03.mockapi.io/locationtest';

            try {
                const response = await fetch(url);
                const data = await response.json();

                if (data.length > 0) {
                    data.forEach(option => {
                        const optionElement = document.createElement('option');
                        optionElement.value = option.location;
                        optionElement.textContent = option.location;
                        destinationDropdown.appendChild(optionElement);
                    });
                } else {
                    console.error('No data found for destination options.');
                }
            } catch (error) {
                console.error('Error fetching destination options:', error);
            }
        }

        function displayRate(location) {
            const url = 'https://660d18973a0766e85dbf8c03.mockapi.io/locationtest';
            const ratesDisplay = document.getElementById('ratesDisplay');

            fetch(url)
            .then(response => response.json())
            .then(data => {
                const selectedLocation = data.find(item => item.location === location);
                if (selectedLocation) {
                    ratesDisplay.innerHTML = `<p>Rate for ${location}: ${selectedLocation.rates}</p>`;
                } else {
                    ratesDisplay.innerHTML = `<p>No rate found for ${location}</p>`;
                }
            })
            .catch(error => {
                console.error('Error fetching rates:', error);
                ratesDisplay.innerHTML = `<p>Error fetching rates</p>`;
            });
        }

        populateOriginDropdown();
        populateDestinationDropdown();

        function calculateDistance(originCoords, destinationCoords) {
            const R = 6371; // Radius of the Earth in km
            const lat1 = originCoords.lat * Math.PI / 180;
            const lat2 = destinationCoords.lat * Math.PI / 180;
            const lon1 = originCoords.lon * Math.PI / 180;
            const lon2 = destinationCoords.lon * Math.PI / 180;

            const dlat = lat2 - lat1;
            const dlon = lon2 - lon1;

            const a = Math.sin(dlat / 2) * Math.sin(dlat / 2) +
                      Math.cos(lat1) * Math.cos(lat2) *
                      Math.sin(dlon / 2) * Math.sin(dlon / 2);

            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

            return R * c;
        }
    </script>
</body>
</html>
